setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
topic_groups <- mytable %>% select( -nct_id ) %>% distinct()
topic_groups %>% View
topic_groups
topic_groups <- mytable %>% select( -nct_id ) %>% distinct() %>% filter( !is.na(pmid))
topic_groups %>% View
topic_groups %>% distinct(pmid)
topic_groups %>% distinct(pmid) %>% nrow
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
write_csv2(mytable, "pmid_msh_label.csv") # just to remember where this comes from.
write_csv2(mytable, "~/ihw/tableAnnotator/Server/pmid_msh_label.csv")
mytable
############### table counts by topic which are either tables with/out subgroup or unnassigned ( which I believe meant unnannotated )
annotated <- read_csv("annotated.csv")
colnames(annotated) = c("pmid","page","tableType")
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
allfiles <- list.files("../../Server/HTML_TABLES") %>% as.data.frame()
colnames(allfiles) = c("filename")
all_docid_with_html <- allfiles %>%  mutate ( filename_orig = filename) %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% select(filename_orig) %>% distinct()
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% select(filename_orig) %>% distinct() %>% nrow
annots <- annotated %>% separate(pmid, c("pmid") ) %>% distinct
topic_counts <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) ) %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
topic_html_pmids <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids
topic_html_pmids %>% distinct(filename_orig) %>% nrow
topic_html_pmids_other <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids_other %>% distinct(filename_orig) %>% nrow
topic_html_pmids %>% distinct(filename_orig) %>% nrow
topic_html_pmids_other %>% distinct(filename_orig) %>% nrow
(topic_html_pmids %>% distinct(filename_orig) %>% nrow)+ (topic_html_pmids_other %>% distinct(filename_orig) %>% nrow)
topic_html_pmids_other %>% distinct(filename_orig) %>% nrow
topic_html_pmids %>% distinct(filename_orig) %>% nrow
annots
annots %>% group_by(pmid,page)
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally %>% arrange(n)
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally %>% arrange(desc(n))
(topic_html_pmids %>% distinct(filename_orig) %>% nrow)+ (topic_html_pmids_other %>% distinct(filename_orig) %>% nrow)
all_docid_with_html
annots <- annotated %>% separate(pmid, c("pmid") ) %>% distinct
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally %>% arrange(desc(n))
topic_counts <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) ) %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
topic_html_pmids <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids
topic_html_pmids %>% View()
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
library(tidyverse)
library(readr)
library(dplyr)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
topic_groups <- mytable %>% select( -nct_id ) %>% distinct() %>% filter( !is.na(pmid))
topic_groups %>% distinct(pmid) %>% nrow
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
mytable
topic_groups
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
mytable
annots
library(tidyverse)
library(readr)
library(dplyr)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
topic_groups <- mytable %>% select( -nct_id ) %>% distinct() %>% filter( !is.na(pmid))
topic_groups %>% distinct(pmid) %>% nrow
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
#mytable <- mytable %>% select(-nct_id) %>% distinct %>% group_by(pmid) %>% mutate(mesh_broad_label = paste0(mesh_broad_label, collapse = "&"))  %>% ungroup() %>% distinct()
write_csv2(mytable, "pmid_msh_label.csv") # just to remember where this comes from.
write_csv2(mytable, "~/ihw/tableAnnotator/Server/pmid_msh_label.csv")
############### table counts by topic which are either tables with/out subgroup or unnassigned ( which I believe meant unnannotated )
annotated <- read_csv("annotated.csv")
colnames(annotated) = c("pmid","page","tableType")
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
allfiles <- list.files("../../Server/HTML_TABLES") %>% as.data.frame()
colnames(allfiles) = c("filename")
all_docid_with_html <- allfiles %>%  mutate ( filename_orig = filename) %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
annots <- annotated %>% separate(pmid, c("pmid") ) %>% distinct
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally %>% arrange(desc(n))
topic_counts <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) ) %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
topic_html_pmids <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids %>% View()
topic_html_pmids_other <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids %>% distinct(filename_orig) %>% nrow
topic_html_pmids_other %>% distinct(filename_orig) %>% nrow
(topic_html_pmids %>% distinct(filename_orig) %>% nrow)+ (topic_html_pmids_other %>% distinct(filename_orig) %>% nrow)
write_csv2(topic_html_pmids, "topic_html_pmids.csv")
#
# colnames(all_docid_with_html) = c("docid")
#
# files_n_annotations <- all_docid_with_html %>% left_join( annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page)) )
#
# files_n_annotations %>% select(tableType) %>% distinct
#
# allNAs <- files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% filter(is.na(mesh_broad_label))
#
# topic_counts <- files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
write_csv2(topic_counts, "topic_counts.csv")
###############################
all_docid_with_html
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally %>% arrange(desc(n))
topic_counts <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) ) %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
annotated
annots <- annotated %>% separate(pmid, c("pmid") ) %>% distinct
annots
library(tidyverse)
library(readr)
library(dplyr)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
topic_groups <- mytable %>% select( -nct_id ) %>% distinct() %>% filter( !is.na(pmid))
topic_groups %>% distinct(pmid) %>% nrow
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
#mytable <- mytable %>% select(-nct_id) %>% distinct %>% group_by(pmid) %>% mutate(mesh_broad_label = paste0(mesh_broad_label, collapse = "&"))  %>% ungroup() %>% distinct()
write_csv2(mytable, "pmid_msh_label.csv") # just to remember where this comes from.
write_csv2(mytable, "~/ihw/tableAnnotator/Server/pmid_msh_label.csv")
############### table counts by topic which are either tables with/out subgroup or unnassigned ( which I believe meant unnannotated )
annotated <- read_csv("annotated.csv")
colnames(annotated) = c("pmid","page","tableType")
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
allfiles <- list.files("../../Server/HTML_TABLES") %>% as.data.frame()
colnames(allfiles) = c("filename")
all_docid_with_html <- allfiles %>%  mutate ( filename_orig = filename) %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
annots <- annotated %>% separate(pmid, c("pmid") ) %>% distinct
annots
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
annots
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_")
############### table counts by topic which are either tables with/out subgroup or unnassigned ( which I believe meant unnannotated )
annotated <- read_csv("annotated.csv")
annotated
############### table counts by topic which are either tables with/out subgroup or unnassigned ( which I believe meant unnannotated )
annotated <- read_csv("annotated.csv")
colnames(annotated) = c("pmid","page","tableType")
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
allfiles <- list.files("../../Server/HTML_TABLES") %>% as.data.frame()
colnames(allfiles) = c("filename")
all_docid_with_html <- allfiles %>%  mutate ( filename_orig = filename) %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_")
annots <- annotated %>% separate(pmid, c("pmid") ) %>% distinct
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally %>% arrange(desc(n))
topic_counts <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) ) %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
topic_html_pmids <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids %>% View()
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
annotated
all_docid_with_html <- allfiles %>%  mutate ( filename_orig = filename) %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html
annotated
all_docid_with_html
all_docid_with_html %>% View()
annotated
annotated %>% separate(pmid, c("pmid") )
all_docid_with_html %>% View()
annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,page))
annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,"_",page))
annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,"_",page)) anti_join( all_docid_with_html )
annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,"_",page)) %>% anti_join( all_docid_with_html )
annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,"_",page)) %>% right_join( all_docid_with_html )
annott <- annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,"_",page))
all_docid_with_html %>% anti_join (annott)
all_docid_with_html %>% inner_join (annott)
all_docid_with_html %>% inner_join (annott) %>% nrow
all_docid_with_html %>% inner_join (annott) %>% nrow
annott %>% nrow
annott
annott %>% select(pmid,page)
annott %>% select(pmid,page) %>% nrow
annott %>% select(pmid,page) %>% nrow
annott <- annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,"_",page))
annott
annott %>%
all_docid_with_html
all_docid_with_html
annott %>%
all_docid_with_html %>% nrow
annott %>%
all_docid_with_html %>% nrow
annott %>%
all_docid_with_html %>% nrow
annott %>%
all_docid_with_html %>% nrow()
all_docid_with_html %>% nrow()
annott
annott %>% distinct(filename)
annott %>% distinct(filename)
all_docid_with_html %>% inner_join (annott) %>% nrow
all_docid_with_html
all_docid_with_html %>% distinct(filename) %>% inner_join (annott) %>% nrow
annott
all_docid_with_html %>% distinct(filename) %>% inner_join (annott %>% distinct(filename) ) %>% nrow
all_docid_with_html %>% distinct(filename) %>% inner_join (annott %>% distinct(filename) ) %>% nrow
all_docid_with_html %>% distinct(filename)
all_docid_with_html %>% distinct(filename) %>% nrow
all_docid_with_html %>% distinct(filename) %>% inner_join (annott %>% distinct(filename) ) %>% nrow
all_docid_with_html %>% distinct(filename) %>% inner_join (annott %>% distinct(filename) ) %>% nrow
all_docid_with_html %>% distinct(filename) %>% nrow
all_docid_with_html %>% nrow
all_docid_with_html %>% distinct(filename) %>% nrow
all_docid_with_html %>% distinct(filename) %>% inner_join (annott %>% distinct(filename) ) %>% nrow
1851-1615
library(tidyverse)
library(readr)
library(dplyr)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
topic_groups <- mytable %>% select( -nct_id ) %>% distinct() %>% filter( !is.na(pmid))
topic_groups %>% distinct(pmid) %>% nrow
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
#mytable <- mytable %>% select(-nct_id) %>% distinct %>% group_by(pmid) %>% mutate(mesh_broad_label = paste0(mesh_broad_label, collapse = "&"))  %>% ungroup() %>% distinct()
write_csv2(mytable, "pmid_msh_label.csv") # just to remember where this comes from.
write_csv2(mytable, "~/ihw/tableAnnotator/Server/pmid_msh_label.csv")
############### table counts by topic which are either tables with/out subgroup or unnassigned ( which I believe meant unnannotated )
annotated <- read_csv("annotated.csv")
colnames(annotated) = c("pmid","page","tableType")
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
allfiles <- list.files("../../Server/HTML_TABLES") %>% as.data.frame()
colnames(allfiles) = c("filename")
all_docid_with_html <- allfiles %>%  mutate ( filename_orig = filename) %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>% left_join(topic_groups) %>% View
all_docid_with_html %>% separate(filename, c("pmid", "page"), "_")
annots <- annotated %>% separate(pmid, c("pmid") ) %>% distinct
annots %>% group_by(pmid,page) %>% select(-tableType) %>% tally %>% arrange(desc(n))
topic_counts <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) ) %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
topic_html_pmids <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( ! (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids %>% View()
topic_html_pmids_other <- all_docid_with_html %>% separate(filename, c("pmid", "page"), "_") %>%
mutate(page = as.integer(page)) %>%
left_join(topic_groups) %>%
left_join(annots) %>% filter( (tableType %in% c("baseline_table","other_table")) )
topic_html_pmids %>% distinct(filename_orig) %>% nrow
topic_html_pmids_other %>% distinct(filename_orig) %>% nrow
(topic_html_pmids %>% distinct(filename_orig) %>% nrow)+ (topic_html_pmids_other %>% distinct(filename_orig) %>% nrow)
write_csv2(topic_html_pmids, "topic_html_pmids.csv")
#
# colnames(all_docid_with_html) = c("docid")
#
# files_n_annotations <- all_docid_with_html %>% left_join( annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page)) )
#
# files_n_annotations %>% select(tableType) %>% distinct
#
# allNAs <- files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% filter(is.na(mesh_broad_label))
#
# topic_counts <- files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
write_csv2(topic_counts, "topic_counts.csv")
###############################
all_docid_with_html %>% View()
annott <- annotated %>% separate(pmid, c("pmid") ) %>% mutate(filename = paste0(pmid,"_",page))
all_docid_with_html %>% nrow
all_docid_with_html %>% distinct(filename) %>% nrow
all_docid_with_html %>% distinct(filename) %>% inner_join (annott %>% distinct(filename) ) %>% nrow
annott %>% nrow
annott %>% distinct(filename)
all_docid_with_html %>%
annott %>% select(pmid,page) %>% nrow
annott %>% select(pmid,page) %>% nrow
all_docid_with_html %>% nrow
all_docid_with_html %>% distinct(filename) %>% nrow
all_docid_with_html %>% distinct(filename) %>% inner_join (annott %>% distinct(filename) ) %>% nrow
annott %>% distinct(pmid,page) %>% nrow
annott %>% distinct(filename)
annott %>% distinct(filename) anti_join( all_docid_with_html %>% distinct(filename) )
annott %>% distinct(filename) %>% anti_join( all_docid_with_html %>% distinct(filename) )
annott %>% distinct(filename) %>% anti_join( all_docid_with_html %>% distinct(filename) ) %>% nrow
annott %>% distinct(filename) %>% anti_join( all_docid_with_html %>% distinct(filename) ) %>% nrow
annott %>% distinct(filename) %>% anti_join( all_docid_with_html %>% distinct(filename) )
annott %>% distinct(filename) %>% anti_join( all_docid_with_html %>% distinct(filename) )  %>% View
library(readr)
extracted <- read_csv("~/ihw/tableAnnotator/annotations/first/extracted.csv")
View(extracted)
problems(...)
problems()
library(readr)
first_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/first/first_batch_results.csv")
View(first_batch_results)
first_batch_results
first_batch_results %>% distinct(docid,page)
first_batch_results %>% distinct(docid,page)
second_annotations <- read_csv("~/ihw/tableAnnotator/annotations/second/second_annotations.csv")
View(second_annotations)
second_annotations %>% distinct(docid,page)
first_batch_results %>% distinct(docid,page)
third_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/third/third_batch_results.csv")
third_batch_results %>% distinct(docid,page)
all_annotations_jul_2019 <- read_csv("~/ihw/tableAnnotator/annotations/all_annotations_jul_2019.csv")
all_annotations_jul_2019 %>% distinct(docid,page) %>% nrow
third_batch_results %>% distinct(docid,page)
first_batch_results %>% distinct(docid,page) %>% nrow
second_annotations %>% distinct(docid,page) %>% nrow
third_batch_results %>% distinct(docid,page) %>% nrow
all_annotations_jul_2019 %>% distinct(docid,page) %>% nrow
first_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/first/first_batch_results.csv") %>% mutate( pmid_tbl=paste0(docid,"_",page))
second_annotations <- read_csv("~/ihw/tableAnnotator/annotations/second/second_annotations.csv") %>% mutate( pmid_tbl=paste0(docid,"_",page))
third_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/third/third_batch_results.csv") %>% mutate( pmid_tbl=paste0(docid,"_",page))
all_annotations_jul_2019 <- read_csv("~/ihw/tableAnnotator/annotations/all_annotations_jul_2019.csv")%>% mutate( pmid_tbl=paste0(docid,"_",page))
first_batch_results %>% distinct(pmid_tbl) %>% nrow
second_annotations %>% distinct(pmid_tbl) %>% nrow
third_batch_results %>% distinct(pmid_tbl) %>% nrow
## This one I think is a copy.
all_annotations_jul_2019 %>% distinct(pmid_tbl) %>% nrow
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl )
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% nrow
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% nrow
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% dim()
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% dim()
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% dim
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% length()
first_batch_results %>% distinct(pmid_tbl) %>% nrow
View(second_annotations)
View(second_annotations)
first_n <- first_batch_results %>% distinct(pmid_tbl) %>% nrow
second_n <- second_annotations %>% distinct(pmid_tbl) %>% nrow
third_n <- third_batch_results %>% distinct(pmid_tbl) %>% nrow
first_n+second_n+third_n
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% length()
first_batch_results %>% inner_join( second_annotations )
first_batch_results  %>% distinct(pmid_tbl) %>% inner_join( second_annotations  %>% distinct(pmid_tbl) )
first_batch_results  %>% distinct(pmid_tbl) %>% inner_join( second_annotations  %>% distinct(pmid_tbl) ) %>% nrow
first_batch_results %>% distinct(pmid_tbl) %>% rbind ( second_annotations  %>% distinct(pmid_tbl) )
first_batch_results %>% distinct(pmid_tbl) %>% rbind ( second_annotations  %>% distinct(pmid_tbl) ) %>% distinct
first_batch_results %>% distinct(pmid_tbl) %>% rbind ( second_annotations  %>% distinct(pmid_tbl) ) %>% distinct %>% nrow
first_and_second_tables <- first_batch_results %>% distinct(pmid_tbl) %>% rbind ( second_annotations  %>% distinct(pmid_tbl) )
first_and_second_tables  %>% distinct %>% nrow ## first and second annotation runs produced 832 unique annotations
first_and_second_tables %>% distinct %>% nrow ## first and second annotation runs produced 832 unique annotations
intersect(first_batch_results$pmid_tbl, second_annotations$pmid_tbl )
intersect(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% length()
first_and_second_tables %>% distinct %>% nrow ## first and second annotation runs produced 832 unique annotations
first_and_second_tables %>% distinct %>% nrow ## first and second annotation runs produced 832 unique annotations
third_batch_results
third_batch_results %>% distinct(pmid_tbl)
third_n <- third_batch_results %>% distinct(pmid_tbl) %>% nrow
third_batch_results %>% distinct(pmid_tbl) ##
third_n <- third_batch_results %>% distinct(pmid_tbl) %>% nrow
second_n <- second_annotations %>% distinct(pmid_tbl) %>% nrow
second_annotations %>% distinct(pmid_tbl) %>% nrow
first_batch_results %>% distinct(pmid_tbl) %>% nrow
(third_batch_results %>% distinct(pmid_tbl))$pmid_tbl
first_and_second_tables
intersect(first_and_second_tables$pmid_tbl (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl)
intersect(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl)
intersect(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% nrow
intersect(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% nrow
intersect(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% length
intersect(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% length #
setdiff(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% length # overlap of 9 with respect of previous runs
setdiff(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% length # overlap of 9 with respect of previous runs
setdiff((third_batch_results %>% distinct(pmid_tbl))$pmid_tbl, first_and_second_tables$pmid_tbl ) %>% length # overlap of 9 with respect of previous runs
intersect(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% length # overlap of 9 with respect of previous runs
setdiff((third_batch_results %>% distinct(pmid_tbl))$pmid_tbl, first_and_second_tables$pmid_tbl ) %>% length # 910 newly annotated tables in run 3.
## This one I think is a copy.
fourth_maybe <- all_annotations_jul_2019 %>% distinct(pmid_tbl)
## This one I think is a copy.
fourth_maybe <- all_annotations_jul_2019 %>% distinct(pmid_tbl) %>% nrow
## This one I think is a copy.
fourth_maybe <- all_annotations_jul_2019 %>% distinct(pmid_tbl)
intersect(fourth_maybe$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl )
setdiff(fourth_maybe$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl )
setdiff(fourth_maybe$pmid_tbl, (first_and_second_tables %>% distinct(pmid_tbl))$pmid_tbl )
intersect(fourth_maybe$pmid_tbl, (first_and_second_tables %>% distinct(pmid_tbl))$pmid_tbl )
intersect(fourth_maybe$pmid_tbl, (first_and_second_tables %>% distinct(pmid_tbl))$pmid_tbl ) %>% nrow
intersect(fourth_maybe$pmid_tbl, (first_and_second_tables %>% distinct(pmid_tbl))$pmid_tbl ) %>% length
library(readr)
first_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/first/first_batch_results.csv") %>% mutate( pmid_tbl=paste0(docid,"_",page))
second_annotations <- read_csv("~/ihw/tableAnnotator/annotations/second/second_annotations.csv") %>% mutate( pmid_tbl=paste0(docid,"_",page))
third_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/third/third_batch_results.csv") %>% mutate( pmid_tbl=paste0(docid,"_",page))
first_n <- first_batch_results %>% distinct(pmid_tbl) %>% nrow #722
second_n <- second_annotations %>% distinct(pmid_tbl) %>% nrow #228
third_n <- third_batch_results %>% distinct(pmid_tbl) %>% nrow #919
first_n+second_n+third_n
setdiff(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% length() # 604 different ones.
intersect(first_batch_results$pmid_tbl, second_annotations$pmid_tbl ) %>% length() ## First and second batch overlap over 118 annotations. # This was because we reinserted tables that failed I think
first_and_second_tables <- first_batch_results %>% distinct(pmid_tbl) %>% rbind ( second_annotations %>% distinct(pmid_tbl) )
first_and_second_tables %>% distinct %>% nrow ## first and second annotation runs produced 832 unique annotations
intersect(first_and_second_tables$pmid_tbl, (third_batch_results %>% distinct(pmid_tbl))$pmid_tbl) %>% length # overlap of 9 with respect of previous runs
setdiff((third_batch_results %>% distinct(pmid_tbl))$pmid_tbl, first_and_second_tables$pmid_tbl ) %>% length # 910 newly annotated tables in run 3.
fourth_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/fourth_DEV/fourth_batch_results.csv")
fourth_n <- fourth_batch_results %>% distinct(pmid_tbl) %>% nrow #919
fourth_batch_results <- read_csv("~/ihw/tableAnnotator/annotations/fourth_DEV/fourth_batch_results.csv") %>% mutate( pmid_tbl=paste0(docid,"_",page))
fourth_n <- fourth_batch_results %>% distinct(pmid_tbl) %>% nrow #919
fourth_n
fourth_n <- fourth_batch_results %>% distinct(pmid_tbl) %>% nrow #219
fourth_n
View(second_annotations)
first_batch_results %>% distinct(pmid_tbl) %>%
rbind(second_annotations %>% distinct(pmid_tbl)) %>%
rbind(third_batch_results %>% distinct(pmid_tbl)) %>%
rbind(fourth_batch_results %>% distinct(pmid_tbl)) %>% distinct %>% nrow
first_batch_results %>% distinct(pmid_tbl) %>%
rbind(second_annotations %>% distinct(pmid_tbl)) %>%
rbind(third_batch_results %>% distinct(pmid_tbl)) %>% nrow
first_batch_results %>% distinct(pmid_tbl) %>%
rbind(second_annotations %>% distinct(pmid_tbl)) %>%
rbind(third_batch_results %>% distinct(pmid_tbl)) %>% distinct %>% nrow
intersect(fourth_batch_results %>% distinct(pmid_tbl),third_batch_results %>% distinct(pmid_tbl))
first_batch_results %>% distinct(pmid_tbl) %>%
rbind(second_annotations %>% distinct(pmid_tbl)) %>%
rbind(third_batch_results %>% distinct(pmid_tbl)) %>% distinct %>% nrow
