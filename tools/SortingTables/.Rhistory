library(tidyverse)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
#mytable <- mytable %>% select(-nct_id) %>% distinct %>% group_by(pmid) %>% mutate(mesh_broad_label = paste0(mesh_broad_label, collapse = "&"))  %>% ungroup() %>% distinct()
write_csv2(mytable, "pmid_msh_label.csv") # just to remember where this comes from.
write_csv2(mytable, "~/ihw/tableAnnotator/Server/pmid_msh_label.csv")
mytable
library(tidyverse)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
mytable
mytable %>% select( -nct_id )
mytable %>% select( -nct_id ) %>% distinct()
library(readr)
annotated <- read_csv("annotated.csv")
View(annotated)
topic_groups <- mytable %>% select( -nct_id ) %>% distinct()
topic_groups
annotated
topic_groups
annotated %>% inner_join(topic_groups)
colnames %>% annotated
annotated %>% colnames
topic_groups %>% colnames
annotated %>% colnames(c("pmid","page","tableType")) %>% inner_join(topic_groups)
annotated %>% colnames(c("pmid","page","tableType"))
colnames(annotated) = c("pmid","page","tableType")
annotated %>% inner_join(topic_groups)
mytable %>% select( -nct_id ) %>% distinct() %>% select(tableType)
mytable %>% select( -nct_id ) %>% distinct()
annotated %>% inner_join(topic_groups)
annotated %>% inner_join(topic_groups) %>% select(tableType)
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
mytable
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
list.files("../../Server/HTML_TABLES")
list.files("../../Server/HTML_TABLES") %>% as.data.frame()
list.files("../../Server/HTML_TABLES") %>% as.data.frame() %>% View
allfiles <- list.files("../../Server/HTML_TABLES") %>% as.data.frame()
allfiles
colnames(allfiles) = c("filename")
allfiles
allfiles %>% mutate(filename = str_split(filename)[0])
allfiles %>% mutate(filename = str_split(filename))
allfiles %>% mutate(filename = filename
allfiles %>% mutate(filename = filename)
library(dplyr)
allfiles %>% mutate(filename = filename)
allfiles %>% mutate(filename = str_split(filename))
allfiles %>% mutate(filename = str_split(filename,"."))
allfiles %>% mutate(filename = str_split(filename,split="."))
allfiles %>% mutate(filename = strsplit(filename, split="."))
allfiles %>% mutate(filename = str_split(filename, pattern="."))
allfiles %>% mutate(filename = strsplit(filename, split="."))
allfiles %>% mutate(filename = str_split(filename, split="."))
allfiles %>% separate(filename, c("filename", "ending"), sep = ".")
allfiles
allfiles %>% separate(filename, c("filename", "ending"), sep = "_")
allfiles %>% separate(filename, c("filename", "ending"), sep = "_")
allfiles %>% separate(filename, c("filename", "ending"), sep = ".")
allfiles %>% separate(filename, c("filename", "ending"), sep = "\.")
allfiles %>% separate(filename, c("filename", "ending"), sep = "\.")
allfiles %>% separate(filename, c("filename", "ending"), sep = ".")
allfiles %>% mutate ( filename =  str_replace(filename, ".html", "") )
allfiles %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v", ""))
allfiles %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v", "")) %>% distinct()
allfiles %>% mutate ( filename =  str_replace(filename, ".html", ""))
allfiles %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
allfiles %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct() %>% nrow()
allfiles %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html <- allfiles %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html
annotated <- read_csv("annotated.csv")
colnames(annotated) = c("pmid","page","tableType")
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
allfiles <- list.files("../../Server/HTML_TABLES") %>% as.data.frame()
colnames(allfiles) = c("filename")
all_docid_with_html <- allfiles %>% mutate ( filename =  str_replace(filename, ".html", "")) %>% mutate ( filename =  str_replace(filename, "v[0-9]", "")) %>% distinct()
all_docid_with_html
annotated %>% inner_join(topic_groups) %>% select(tableType) %>% distinct
annotated %>% inner_join(topic_groups)
annotated %>% inner_join(topic_groups)
all_docid_with_html
annotated %>% inner_join(topic_groups)
annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page))
all_docid_with_html
colnames(all_docid_with_html) = c("docid")
all_docid_with_html %>% inner_join( annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page)) )
all_docid_with_html %>% left_join( annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page)) )
all_docid_with_html %>% left_join( annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page)) ) %>% select(tableType) %>% distinct
all_docid_with_html %>% left_join( annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page)) )
files_n_annotations <- all_docid_with_html %>% left_join( annotated %>% inner_join(topic_groups) %>% mutate( docid = paste0(pmid,"_",page)) )
files_n_annotations
files_n_annotations
files_n_annotations %>% select(tableType) %>% distinct
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") )
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% select(tableType) %>% distinct
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") )
topic_groups
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") )
topic_groups
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") )
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") )
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_")
topic_groups
topic_groups %>% colnames
topic_groups %>% colnames()
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% left_join(topic_groups)
topic_groups %>% View
View(eligible_nct_ids_pmids)
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% left_join(topic_groups)
View(conditions_lkp)
View(eligible_nct_ids_pmids)
View(eligible_nct_ids_pmids)
View(conditions_lkp)
library(tidyverse)
library(readr)
library(dplyr)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
topic_groups <- mytable %>% select( -nct_id ) %>% distinct()
mytable <- mytable %>% select(-nct_id) %>%
filter(! is.na(pmid)) %>% distinct %>%
group_by(mesh_broad_label) %>% mutate(pmid = paste0(pmid, collapse = "&")) %>%
ungroup() %>% distinct()
mytable
library(tidyverse)
library(readr)
library(dplyr)
setwd("~/ihw/tableAnnotator/tools/SortingTables")
load("~/ihw/tableAnnotator/tools/SortingTables/trials_conditions_lookup_atc_code_lookup.Rdata")
eligible_nct_ids_pmids <- readRDS("~/ihw/tableAnnotator/tools/SortingTables/eligible_nct_ids_pmids.Rds")
mytable <- conditions_lkp %>% select(nct_id,mesh_broad_label) %>% left_join(eligible_nct_ids_pmids %>% filter(!is.na(pmid)))
# mytable %>% View()
#
# new_obj <- readRDS("~/ihw/tableAnnotator/tools/RDS_TO_HTML/new_obj.rds")
# new_obj %>% select(pmid_tbl) %>% separate(pmid_tbl, c("pmid", "table"), "_") %>% select(pmid) %>% distinct() -> study_pmids
#
# tables_with_mesh_broad_labels <- mytable %>% filter( pmid %in% study_pmids$pmid )
#
# tables_with_mesh_broad_labels %>% arrange(pmid) %>% View
#
mytable %>% View()
topic_groups
topic_groups %>% View
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% left_join(topic_groups)
topic_groups
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% left_join(topic_groups)
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups)
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% View
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% View
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% tally
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally %>% View
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% sum(n)
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% sum(n)
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% tally
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally %>% View
files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
topic_counts <- files_n_annotations %>% filter( ! tableType %in% c("baseline_table","other_table") ) %>% separate(docid, c("pmid", "page"), "_") %>% select(-mesh_broad_label) %>% left_join(topic_groups) %>% distinct %>% select(mesh_broad_label) %>% group_by(mesh_broad_label) %>% tally
topic_counts
write_csv2(topic_counts, "topic_counts.csv")
